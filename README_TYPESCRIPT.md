# TypeScript Conversion - Astro Party Game

## Обзор

Проект успешно конвертирован из JavaScript в TypeScript с использованием современных практик и строгой типизации.

## Структура проекта

```
lanparty/
├── src/
│   ├── server/              # Серверная часть (Node.js + Express + WebSocket)
│   │   ├── index.ts         # Главный файл сервера
│   │   ├── game-manager.ts  # Логика управления игрой
│   │   └── game-constants.ts # Константы игры
│   ├── shared/              # Общие типы для клиента и сервера
│   │   └── game-types.ts    # Определения типов и интерфейсов
│   └── client/              # Клиентская часть
│       ├── display.html     # Главный экран игры
│       └── control.html     # Интерфейс управления
├── dist/                    # Скомпилированные файлы (генерируется)
├── tsconfig.json           # Конфигурация TypeScript для сервера
├── tsconfig.client.json    # Конфигурация TypeScript для клиента
├── package.json            # Зависимости и скрипты
└── copy-html.cjs          # Скрипт копирования HTML файлов

```

## Основные изменения

### 1. Конфигурация TypeScript

- **tsconfig.json** - для серверной части с ES2020 модулями
- **tsconfig.client.json** - для клиентской части с поддержкой DOM

### 2. Типизация

Созданы строгие типы в [`src/shared/game-types.ts`](src/shared/game-types.ts):

- `GameState` - состояния игры (LOBBY, PLAYING, FINISHED)
- `Player` - данные игрока
- `Bullet` - данные снаряда
- `GameStateData` - полное состояние игры
- WebSocket сообщения (ClientMessage, ServerMessage)

### 3. Модульная архитектура

Код разделен на логические модули:

- **GameManager** - управление состоянием игры, игроками, физикой
- **game-constants** - все константы игры в одном месте
- **index.ts** - WebSocket сервер и обработка подключений

### 4. Зависимости

Добавлены TypeScript зависимости:

```json
{
  "devDependencies": {
    "@types/express": "^4.17.21",
    "@types/node": "^20.10.5",
    "@types/ws": "^8.5.10",
    "typescript": "^5.3.3"
  }
}
```

## Команды

### Разработка

```bash
# Установка зависимостей
npm install

# Сборка проекта
npm run build

# Запуск сервера
npm start

# Разработка с автоперезагрузкой
npm run dev

# Очистка скомпилированных файлов
npm run clean
```

### Отдельные команды сборки

```bash
# Сборка только сервера
npm run build:server

# Сборка только клиента
npm run build:client

# Копирование HTML файлов
npm run copy:html
```

## Преимущества TypeScript версии

1. **Строгая типизация** - ошибки типов обнаруживаются на этапе компиляции
2. **Автодополнение** - улучшенная поддержка IDE
3. **Рефакторинг** - безопасное переименование и изменение кода
4. **Документация** - типы служат документацией кода
5. **Масштабируемость** - легче поддерживать большие проекты

## Особенности реализации

### ES Modules

Проект использует ES модули (`"type": "module"` в package.json):

- Импорты с расширением `.js` (TypeScript компилирует в `.js`)
- `import` вместо `require`
- `export` вместо `module.exports`

### Физика игры

Реализована реалистичная физика:

- Инерция движения кораблей
- Упругие столкновения с сохранением импульса
- Точная детекция коллизий треугольников (корабли)
- Wrap-around экрана

### WebSocket коммуникация

Типизированные сообщения между клиентом и сервером:

- Регистрация игроков с UUID для переподключения
- Синхронизация состояния игры 60 FPS
- Обработка управления (поворот, выстрел)

## Миграция с JavaScript

Если у вас есть старая JavaScript версия:

1. Старые файлы остались в корне: [`server.js`](server.js), [`index.html`](index.html), [`control.html`](control.html)
2. Новая TypeScript версия в папке `src/`
3. Скомпилированные файлы в папке `dist/`

Для запуска старой версии:

```bash
node server.js
```

Для запуска новой TypeScript версии:

```bash
npm run build && npm start
```

## Решение проблем

### Порт уже используется

Если видите ошибку `EADDRINUSE`:

```bash
# Найти процесс на порту 3000
lsof -i :3000

# Убить процесс
kill -9 <PID>
```

Или измените порт:

```bash
PORT=3001 npm start
```

### Ошибки компиляции

Убедитесь, что установлены все зависимости:

```bash
npm install
```

Очистите и пересоберите:

```bash
npm run clean && npm run build
```

## Дальнейшее развитие

Возможные улучшения:

1. Добавить клиентский TypeScript код
2. Добавить тесты (Jest + TypeScript)
3. Добавить линтер (ESLint)
4. Добавить форматтер (Prettier)
5. Настроить CI/CD

## Лицензия

Тот же, что и у оригинального проекта.
